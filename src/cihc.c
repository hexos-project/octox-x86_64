#include <ihc.h>
#include <extc.h>

#define IHC_HANDLER(n) \
void ihc##n##_handler(void) { \
    if (ihc_handlers[n] == NULL) return; \
    ihc_handlers[n](n); \
}

ihc_handler_t ihc_handlers[256];

void ihc_init(void) {
    for (int i = 0; i < 256; i++) {
        ihc_handlers[i] = ihc_default_handler;
    }
}

void ihc_set_handler(u8 n, ihc_handler_t handler) {
    ihc_handlers[n] = handler;
}

void ihc_default_handler(u8 n, state_t state) {
    uart_puts("Unhandled interrupt: ");
    uart_puthex(n);
    uart_puts("\n");
}

IHC_HANDLER(0)
IHC_HANDLER(1)
IHC_HANDLER(2)
IHC_HANDLER(3)
IHC_HANDLER(4)
IHC_HANDLER(5)
IHC_HANDLER(6)
IHC_HANDLER(7)
IHC_HANDLER(8)
IHC_HANDLER(9)
IHC_HANDLER(10)
IHC_HANDLER(11)
IHC_HANDLER(12)
IHC_HANDLER(13)
IHC_HANDLER(14)
IHC_HANDLER(15)
IHC_HANDLER(16)
IHC_HANDLER(17)
IHC_HANDLER(18)
IHC_HANDLER(19)
IHC_HANDLER(20)
IHC_HANDLER(21)
IHC_HANDLER(22)
IHC_HANDLER(23)
IHC_HANDLER(24)
IHC_HANDLER(25)
IHC_HANDLER(26)
IHC_HANDLER(27)
IHC_HANDLER(28)
IHC_HANDLER(29)
IHC_HANDLER(30)
IHC_HANDLER(31)
IHC_HANDLER(32)
IHC_HANDLER(33)
IHC_HANDLER(34)
IHC_HANDLER(35)
IHC_HANDLER(36)
IHC_HANDLER(37)
IHC_HANDLER(38)
IHC_HANDLER(39)
IHC_HANDLER(40)
IHC_HANDLER(41)
IHC_HANDLER(42)
IHC_HANDLER(43)
IHC_HANDLER(44)
IHC_HANDLER(45)
IHC_HANDLER(46)
IHC_HANDLER(47)
IHC_HANDLER(48)
IHC_HANDLER(49)
IHC_HANDLER(50)
IHC_HANDLER(51)
IHC_HANDLER(52)
IHC_HANDLER(53)
IHC_HANDLER(54)
IHC_HANDLER(55)
IHC_HANDLER(56)
IHC_HANDLER(57)
IHC_HANDLER(58)
IHC_HANDLER(59)
IHC_HANDLER(60)
IHC_HANDLER(61)
IHC_HANDLER(62)
IHC_HANDLER(63)
IHC_HANDLER(64)
IHC_HANDLER(65)
IHC_HANDLER(66)
IHC_HANDLER(67)
IHC_HANDLER(68)
IHC_HANDLER(69)
IHC_HANDLER(70)
IHC_HANDLER(71)
IHC_HANDLER(72)
IHC_HANDLER(73)
IHC_HANDLER(74)
IHC_HANDLER(75)
IHC_HANDLER(76)
IHC_HANDLER(77)
IHC_HANDLER(78)
IHC_HANDLER(79)
IHC_HANDLER(80)
IHC_HANDLER(81)
IHC_HANDLER(82)
IHC_HANDLER(83)
IHC_HANDLER(84)
IHC_HANDLER(85)
IHC_HANDLER(86)
IHC_HANDLER(87)
IHC_HANDLER(88)
IHC_HANDLER(89)
IHC_HANDLER(90)
IHC_HANDLER(91)
IHC_HANDLER(92)
IHC_HANDLER(93)
IHC_HANDLER(94)
IHC_HANDLER(95)
IHC_HANDLER(96)
IHC_HANDLER(97)
IHC_HANDLER(98)
IHC_HANDLER(99)
IHC_HANDLER(100)
IHC_HANDLER(101)
IHC_HANDLER(102)
IHC_HANDLER(103)
IHC_HANDLER(104)
IHC_HANDLER(105)
IHC_HANDLER(106)
IHC_HANDLER(107)
IHC_HANDLER(108)
IHC_HANDLER(109)
IHC_HANDLER(110)
IHC_HANDLER(111)
IHC_HANDLER(112)
IHC_HANDLER(113)
IHC_HANDLER(114)
IHC_HANDLER(115)
IHC_HANDLER(116)
IHC_HANDLER(117)
IHC_HANDLER(118)
IHC_HANDLER(119)
IHC_HANDLER(120)
IHC_HANDLER(121)
IHC_HANDLER(122)
IHC_HANDLER(123)
IHC_HANDLER(124)
IHC_HANDLER(125)
IHC_HANDLER(126)
IHC_HANDLER(127)
IHC_HANDLER(128)
IHC_HANDLER(129)
IHC_HANDLER(130)
IHC_HANDLER(131)
IHC_HANDLER(132)
IHC_HANDLER(133)
IHC_HANDLER(134)
IHC_HANDLER(135)
IHC_HANDLER(136)
IHC_HANDLER(137)
IHC_HANDLER(138)
IHC_HANDLER(139)
IHC_HANDLER(140)
IHC_HANDLER(141)
IHC_HANDLER(142)
IHC_HANDLER(143)
IHC_HANDLER(144)
IHC_HANDLER(145)
IHC_HANDLER(146)
IHC_HANDLER(147)
IHC_HANDLER(148)
IHC_HANDLER(149)
IHC_HANDLER(150)
IHC_HANDLER(151)
IHC_HANDLER(152)
IHC_HANDLER(153)
IHC_HANDLER(154)
IHC_HANDLER(155)
IHC_HANDLER(156)
IHC_HANDLER(157)
IHC_HANDLER(158)
IHC_HANDLER(159)
IHC_HANDLER(160)
IHC_HANDLER(161)
IHC_HANDLER(162)
IHC_HANDLER(163)
IHC_HANDLER(164)
IHC_HANDLER(165)
IHC_HANDLER(166)
IHC_HANDLER(167)
IHC_HANDLER(168)
IHC_HANDLER(169)
IHC_HANDLER(170)
IHC_HANDLER(171)
IHC_HANDLER(172)
IHC_HANDLER(173)
IHC_HANDLER(174)
IHC_HANDLER(175)
IHC_HANDLER(176)
IHC_HANDLER(177)
IHC_HANDLER(178)
IHC_HANDLER(179)
IHC_HANDLER(180)
IHC_HANDLER(181)
IHC_HANDLER(182)
IHC_HANDLER(183)
IHC_HANDLER(184)
IHC_HANDLER(185)
IHC_HANDLER(186)
IHC_HANDLER(187)
IHC_HANDLER(188)
IHC_HANDLER(189)
IHC_HANDLER(190)
IHC_HANDLER(191)
IHC_HANDLER(192)
IHC_HANDLER(193)
IHC_HANDLER(194)
IHC_HANDLER(195)
IHC_HANDLER(196)
IHC_HANDLER(197)
IHC_HANDLER(198)
IHC_HANDLER(199)
IHC_HANDLER(200)
IHC_HANDLER(201)
IHC_HANDLER(202)
IHC_HANDLER(203)
IHC_HANDLER(204)
IHC_HANDLER(205)
IHC_HANDLER(206)
IHC_HANDLER(207)
IHC_HANDLER(208)
IHC_HANDLER(209)
IHC_HANDLER(210)
IHC_HANDLER(211)
IHC_HANDLER(212)
IHC_HANDLER(213)
IHC_HANDLER(214)
IHC_HANDLER(215)
IHC_HANDLER(216)
IHC_HANDLER(217)
IHC_HANDLER(218)
IHC_HANDLER(219)
IHC_HANDLER(220)
IHC_HANDLER(221)
IHC_HANDLER(222)
IHC_HANDLER(223)
IHC_HANDLER(224)
IHC_HANDLER(225)
IHC_HANDLER(226)
IHC_HANDLER(227)
IHC_HANDLER(228)
IHC_HANDLER(229)
IHC_HANDLER(230)
IHC_HANDLER(231)
IHC_HANDLER(232)
IHC_HANDLER(233)
IHC_HANDLER(234)
IHC_HANDLER(235)
IHC_HANDLER(236)
IHC_HANDLER(237)
IHC_HANDLER(238)
IHC_HANDLER(239)
IHC_HANDLER(240)
IHC_HANDLER(241)
IHC_HANDLER(242)
IHC_HANDLER(243)
IHC_HANDLER(244)
IHC_HANDLER(245)
IHC_HANDLER(246)
IHC_HANDLER(247)
IHC_HANDLER(248)
IHC_HANDLER(249)
IHC_HANDLER(250)
IHC_HANDLER(251)
IHC_HANDLER(252)
IHC_HANDLER(253)
IHC_HANDLER(254)
IHC_HANDLER(255)
